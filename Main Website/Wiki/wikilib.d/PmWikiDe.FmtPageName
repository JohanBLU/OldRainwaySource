version=pmwiki-2.2.92 ordered=1 urlencoded=1
author=mfwolff
charset=UTF-8
csum=replace PageVariables with asterisks  like {*$FullName}
ctime=1205601734
name=PmWikiDe.FmtPageName
rev=18
targets=PmWikiDe.Functions,PmWikiDe.Variables,PmWikiDe.Internationalizations,PmWikiDe.PageVariables,PmWiki.ReleaseNotes,PmWikiDe.OtherVariables,Cookbook.Functions
text=(:title FmtPageName():)%0a(:Summary: Diese Seite beschreibt eine interne Funktion in PmWiki-Engine namens "[=FmtPageName()=]" :)%0a(:Original_Page: PmWiki.{$Name}:)%0a(:Translation_Date: 2011-05-04:)%0a(:Translation_Status: %25green%25fertig%25%25:)%0a(:Audience: Administratoren (Fortgeschrittene), System:)%0a%0aDiese Seite beschreibt eine interne Funktion in PmWiki. Diese Seite ist nicht für Leute mit einem schwachen Herzen bestimmt ;-)%0a%0aSiehe auch [[PmWikiDe/Functions|+]]%0a%0a!! [[#FmtPageName]] [@FmtPageName@]($fmt, $pagename)%0a%0a[[#FmtPageName-desc]] %0aDie Funktion gibt [@$fmt@] wieder zurück, nachdem darin Variablen-Ersetzungen und Internationalisierung durchgeführt worden sind unter der Vorgabe, dass der Name der Seite [@$pagename@] ist.%0aDabei wird die Regel angewandt, dass zuerst die Variablen behandelt werden, deren Namen auf 'Fmt' endet (wie $GroupFooterFmt), aber auch solche Strings, die eine %25newwin%25[[Wikipedia:Variable_%2528programming%2529#Interpolation|Interpolation]] erfordern, insbesondere die Seitenvorlagendatei (.tmpl). %0aSiehe [[PmWikiDe.Variables|+]] wegen einer (unvollständigen) Liste von zur Verfügung stehenden Variablen und [[PmWikiDe.Internationalizations|+]] wegen der Internationalisierung.%0a%0aDie Funktion [@FmtPageName()@] wendet Internationalisierungs- und Variablen-Ersetzungen auf den String [@$fmt@] an unter der Vorgabe, der Name der aktuellen Seite sei [@$pagename@].%0a%0aDas Ersetzen geht so:%0a%0a# Ersetze alle Variablen der Form [@$XyzFmt@] durch den zugehörenden Wert einer globalen Variable.%0a# Bearbeite den String wegen aller [@$[...]@]Phrasen (Internationalisierte Phrasen) mit Hilfe der aktuell geladenen Übersetzungstabelle.%0a# Ersetze alle Vorkommen von [@{$ScriptUrl}@] durch [@$ScriptUrl@] (um die Abarbeitung der URI-Bearbeitungs-Phase hinauszuschieben).%0a# Ersetze alle Vorkommen von Standard-[[PmWikiDe/PageVariables|Seiten-Variablen]] (beginnend mit einem Großbuchstaben, gefolgt von wenigstens einem Wortzeichen) durch ihre Werte. Hier werden seit Version 2.2.92 auch Seitenvariablen mit Sternen wie [@{*$FullName}@] ersetzt (siehe [[(PmWiki:)ReleaseNotes]]). %25green%25Beachten Sie, dass SVs der Form [@{Group.Page$Var}@] '''nicht''' ersetzt werden.%25%25 Wenn es keine weiteren $-Sequenzen gibt, gib den formatierten String zurück und beende die Funktion.%0a# Führe alle Musterersetzungen aus dem Array @@$FmtP@@ (P=pattern/Muster) durch. Typischerweise wird das verwendet, um Dinge wie $Name und $Group etc., die spezifisch für die aktuelle Seite sind, zu behandeln. %25green%25Das scheint eingesetzt zu werden in robot.php, um Seitenverweise mit einer Aktion (z. B. Seite?action=edit) so umzuwandeln, dass ein Suchroboter ihnen nicht folgt (der Roboter wird gezielt hinters Licht geführt, siehe [[PmWikiDe/OtherVariables|+]]). %0a# Ersetze alle übrig gebliebenen Vorkommen von Seiten-Variablen durch ihre Werte. %25green%25Annmerkung: Diese Variablen sind dann von der Form [@$var@] (kleines 'v'), nicht von der übliche SV-Form [@{$Var}@] (großes 'V').%0a# Wenn $EnablePathInfo nicht gesetzt ist, wandle @@URIs@@ um in die Schreibweise $ScriptUrl?n=%3cGroup>.%3cName> anstelle von $ScriptUrl/%3cGroup>/%3cName>. Ersetze $ScriptUrl in beiden Fällen durch seinen Wert. Gibt es keine weiteren $-Sequenzen, gib den formatierten String zurück und beende damit die Funktion. %0a# Ersetze alle $-Sequenzen durch globale Variablen gleichen Namens (nötigenfalls zwischenspeichern) in umgekehrter alphabetischer Reihenfolge, filtere alle unsicheren Globalen heraus.%0a# Ersetze alle $-Sequenzen durch Werte aus dem Array $FmtV.%0a%0aAnmerkung: [@FmtPageName@]() erkennt alle globalen Variablen automatisch. Allerdings existiert das Array $FmtV, weil globale Variablen zu ändern aufwändig ist. So wird das ständige Wiederaufbauen des Variablenzwischenspeichers für sich häufig ändernde Variablen vermieden.%0a%0a!! Sicherheit%0a%0aPM zufolge ist es generell unklug, die Funktion FmtPageName() für Strings aufzurufen, die aus Seiten-Markups stammen, denn das eröffnet Jemandem die Möglichkeit, Variablenwerte zu sehen, die er vielleicht nicht hätte sehen sollen. Das ist auch der Grund, warum Seiten-Variablen (die aus Markups stammen) PageVar() und PageTextVar() verwenden und nicht durch FmtpageName() gehen. %0a%0a!! Erreichbarkeit von Variablen in FmtPageName%0a%0aUm ganz präzise zu sein, das schreibt PM in Bezug auf verschiedene Wege, eine Variable zu definieren, die von FmtPageName verwendet werden kann (wenn es einen String formatiert):%0a%0a* Setzen Sie eine globale Variable. FmtPageName() führt automatisch Ersetzungen durch für alle globalen Variablen, die keine Arrays sind. Wenn aber die Variable ihren Wert während wiederholter Aufrufe von FmtPageName() verändern wird, ist es möglicherweise besser, $FmtV zu verwenden wie im nächsten Punkt.%0a%0a* Fügen Sie ein Variablen/Wert-Paar in das $FmtV-Array ein. [@$FmtV['$MyVariable']='something'@] bedeutet, ersetze alle Vorkommen von '[@$MyVariable@]' durch '@@something@@'. Verwenden sie dies für Variablen, die ihren Wert während wiederholter Aufrufe von FmtPageName() verändern werden.%0a%0a* Fügen Sie ein Muster/Ersetzung-Paar in das $FmtP-Array ein. Dies wird normalerweise für Ersetzungen gemacht, die dynamisch sein müssen, weil sie in gewisser Weise auf dem referenzierten Seitennamen basieren, so wie '$Title', '$Group', '$Name', $PageUrl', etc.%0a%0aSiehe auch [[Cookbook:Functions#FmtPageName]]%0a%0aSchließlich gibt es hier noch etwas, das PM geschrieben hat, was sich auf diese Funktion bezieht und erklärt, wozu wir sie haben:%0a%0a-> Um seine Ausgabe zu erstellen, muss PmWiki eine Vielfalt von Stringersetzungen vornehmen:%0a%0a## zum Erzeugen des vollen Namen, der Gruppe, des Titels oder der URL einer Seite (die verschieden ist von der aktuell angezeigten Seite),%0a## zum Einsetzen der globalen Variablenwerte,%0a## zum Durchführen der Internationalisierung,%0a## zum Umwandeln von @@$ScriptUrl/$Group/$Name@@ in @@$ScriptUrl?n=$Group.$Name@@ für Sites, die keine PATH_INFO-Urls handhaben können,%0a## für andere Ersetzungen, die bestimmte Funktionen brauchen.%0a%0a-> PmWiki führt alle dieser Ersetze-einen-Dynamische-Wert-in-einem-String in der FmtPageName()-Funktion zusammen. Weil einige Dinge extrem dynamisch sind, solche wie die Url oder die Gruppe für eine beliebige Seite, die nicht die aktuell angezeigte ist, können diese Dinge nicht einfach globale Variablen sein. Oder wenn sie doch globale Variablen würden, wären sie Variablen, die nicht zuverlässig Werte für eine lange Zeit behielten, weile einige andere Routinen (die gerade einen String einer anderen Seite formatieren) daherkommen und den Wert auf etwas setzen, was sie gerade brauchen.%0a%0a->Ein begrenzter Satz von $-Ersetzungen &mdash; grundsätzlich alles, was mit einem Seitenattribut korrespondiert &mdash; sind keine PHP-Variablen und sind nur erreichbar über die FmtPageName()-Funktion. Der vollständige Satz dieser speziellen Variablen ist $Group, $Name, $FullName, $PageUrl, $Title, $Titlespaced, $Namespaced, $Groupspaced, $LastModifiedBy, $LastModifiedHost und $LastModified. Diese Dinge können nicht einfach PHP-Standardvariablen sein, weil sich PmWiki oft den URL, den Namen, den Titel etc. einer anderen Seite besorgen muss als jenen der aktuell im Browser betrachteten Seite.%0a%0a-> Im Moment können $Title, $LastModified, $LastModifiedBy und $LastModifiedHost nur funktionieren, wenn die Attribute der Seite geladen und zwischengespeichert sind unter Verwendung der `PCache-Funktion. So muss man, um an diese Werte zu kommen, typischerweise Folgendes ausführen:%0a%0a-> [@%0a$page = ReadPage($pagename);%0aPCache($pagename, $page);%0a$ptitle = FmtPageName('$Title', $pagename);%0a$pauthor = FmtPageName('$LastModifiedBy', $pagename);%0a@]%0a
time=1480617110
title=FmtPageName()
