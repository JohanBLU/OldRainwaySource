version=pmwiki-2.2.106 ordered=1 urlencoded=1
author=MFWolff
charset=UTF-8
csum=$MailFunction
ctime=1160917200
name=PmWikiDe.Notify
rev=21
targets=PmWikiDe.Notify,PmWikiDe.MailPosts,PmWikiDe.LocalCustomizations,PmWiki.Notify,SiteAdmin.NotifyList,PmWikiDe.PageLists,PmWikiDe.WikiTrails,PmWiki.BasicVariables,PmWiki.UTF-8,PITS.01159
text=(:title E-Mail Nachricht bei geänderten Seiten (neu):)%0a(:Summary: E-Mail-Benachrichtigungen bei Änderungen einrichten und konfigurieren:)%0a(:Original_Page: PmWiki.{$Name}:)%0a(:Translation_Date: 2011-05-07:)%0a(:Translation_Status: %25green%25fertig%25%25:)%0a(:Audience: Autoren (Fortgeschritten) und Administratoren:)%0a%25comment%25Durch die Einführung von [[notify|+]] ergibt sich, dass es momentan zwei Seiten zur 'E-mail Nachricht bei geänderten Seiten' gibt. Die Alte ist unter : [[MailPosts|+]] zu erreichen und muss als Dokumentation für Pmwiki-System bis Version 2.1.7 herangezogen werden%25%25%0a%0aDas ''notify.php''-Skript ermöglicht es einem Site-Administrator, PmWiki so zu konfigurieren, dass Emails verschickt werden, wenn Seiten des Wikis verändert werden. Diese Benachrichtigungen können so eingestellt werden, dass  mehrere Seitenveränderungen, die in einem kurzen Zeitintervall stattfinden, in einer einzigen Email zusammengefasst werden (um überlaufende Emailfächer zu verhindern).%0a%0aDieses Feature ist besonders für Sites nützlich, die unregelmäßige Updates haben, da dann die "$[Recent Changes]"-Seite nicht ständig nach neuen Veränderungen durchforstet werden muss.%0a%0aDamit die Benachrichtigungen funktionieren, muss das ''notify.php''-Script durch [[local customizations|lokale Anpassungen]] aktiviert werden. Das funktioniert normalerweise sehr einfach, indem man folgende Zeile in die ''local/config.php'' schreibt:%0a%0a->$EnableNotify = 1;%0a%0a!! Benachrichtigung konfigurieren%0a%0aWenn das Script erstmal aktiviert ist, erhält das Benachrichtigungssystem seine Einstellungen von der  [[SiteAdmin.NotifyList]]-Seite (die man beim ersten Mal neu anlegen muss).  Die SiteAdmin.NotifyList-Seite enthält Einträge der Form:%0a%0a->[@notify=alice@beispiel.de@]%0a%0aDas bedeutet, dass alle Informationen über Veränderungen in den Wiki-Seiten in regelmäßigen Abständen an ''alice@beispiel.de'' geschickt werden sollen.  Die SiteAdmin.NotifyList-Seite kann mehrere "notify=" Zeilen enthalten, um Nachrichten an mehrere Adressen zu senden, die Benachrichtigungen werden dann an eben diese Adressen geschickt. Die "notify=" Zeilen können vor Lesern verborgen werden, indem man sie innerhalb einer  [@(:if false:)@] Sektion auflistet.%0a%0a->{+Anmerkung+}%0a->Setzen Sie keine Leerzeichen um die Gleicheitszeichen herum! Die Benachrichtigung wird still und leise versagen, wenn Sie %0a-->%25red%25[@notify  =  fred@beispiel.de@]%0a->anstatt%0a-->%25green%25[@notify=fred@beispiel.de@]%0a->schreiben.%0a%0a%0a!! Benachrichtigungsoptionen%0a%0aDie grundlegenden Syntax ist%0a->@@notify=''email@address'' \%0a  [[#notifyname|name]]=''abc'' \%0a  [[#notifygroup|group]]=''def''  \%0a  [[#notifytrail|trail]]=''ghi'' \%0a  [[#notifysquelch|squelch]]=''123'' \%0a  [[#notifydelay|delay]]=''123'' \%0a  @@%0a%0aEs gibt eine ganze Reihe von Optionen, um die Zahl der Seiten, die eine Benachrichtigung veranlassen, zu verringern. Die [@group=@]- und [@name=@]-Parameter können eingesetzt werden, um Benachrichtigungen auf bestimmte Seiten oder Gruppen zu beschränken: %0a%0a[[#notifygroup]]%0a->@@# Schicke Benachrichtigung über die Main-Gruppe an alice@beispiel.de@@%0a->@@notify=alice@beispiel.de '''group'''=Main@@%0a%0a-># Benachrichtige charles@beispiel.de über Veränderungen auf allen Seiten außer denen der Gruppe Main%0a->@@notify=charles@beispiel.de '''group'''=-Main@@%0a%0a[[#notifyname]]%0a->@@# Benachrichtige bob@beispiel.de über alle Änderungen auf der HomePage@@%0a->@@notify=bob@beispiel.de '''name'''=Main.HomePage@@%0a%0a->{+Anmerkung+}%0a->Die Optionen sind der [[PmWikiDe/PageLists | Seitenlisten-Syntax]] ähnlich.%0a%0a[[#notifytrail]]%0aUm eine willkürliche Liste von Seiten zu verwalten, z. B. "Beobachtungslisten" ("watchlists"), ist es generell einfacher, einen %0a[[trail -> WikiTrails]] der zu beobachtenden Seiten zusammenzustellen. Der folgende Eintrag in der SiteAdmin.NotifyList-Seite sendet an alice@beispiel.de eine E-Mail, die Änderungen an allen Seiten meldet, die im 'trail' in Profiles.Alice aufgelistet sind:%0a%0a->@@# benachrichtige Alice über alle Änderungen an Seiten, die in Profiles.Alice aufgelistet sind@@%0a->@@notify=alice@beispiel.de '''trail'''=Profiles.Alice@@%0a%0a{+Anmerkung+}\\%0aSobald dieser Eintrag in der SiteAdmin.NotifyList-Seite eingefügt ist, kann Alice ihre Beobachtungsliste leicht verändern, indem sie ihre Profilseite Profiles.Alice bearbeitet. Die SiteAdmin.NotifyList-Seite zu bearbeiten ist dann nicht mehr nötig. Isbesondere bedeutet das, dass ein Administrator die Rechte zum Bearbeiten der SiteAdmin.NotifyList-Seite einschränken kann, und doch Einzelnen erlauben kann, ihre Benachrichtigungen in anderen Seiten zu verwalten.     %0a%0aGrenzen dieses Features:%0a* nur dem 'trail' manuell hinzugefügte Verweise werden in die Benachrichtigungsliste aufgenommen (weder "group=" oder andere Seitenlistensyntax, noch "Gruppe.RecentChanges"-Verweise erzeugen eine Benachrichtigung).%0a* Der Einsatz einer [@(:include:)@]-Direktive ist keine funktionierende Umgehung dieses Mangels.%0a%0aDas ist möglicherweise eine gute Stelle, um herauszustellen, dass der Bearbeiten-Zugriff auf die%0aSiteAdmin.NotifyList-Seite kontrolliert werden sollte, sonst könnten Böswillige die Benachrichtigungsfähigkeiten ausnutzen, um die Mailbox Anderer zu überfluten. Standardmäßig ist die SiteAdmin.NotifyList-Seite geschützt gegen Lesen oder Bearbeiten außer durch den Administrator (was für die meisten Seiten in der SiteAdmin-Gruppe gilt). %0a%0a!! Hinzufügen von Benachrichtigungen durch lokale Anpassung%0a%0aBenachrichtigunseinträge können auch über das $NotifyList-Array in ''local/config.php'' hinzugefügt werden. Fügen Sie einfach Zeilen wie die folgenden ein:%0a%0a->@@ $EnableNotify = 1;@@%0a->@@ $NotifyList[] = 'notify=alice@beispiel.de group=Main';@@%0a->@@ $NotifyList[] = 'notify=bob@beispiel.de name=Main.HomePage';@@%0a%0a[[#controlling_notification_frequency]]%0a[[#notifysquelch]]%0a!! Kontrolle über die Benachrichtigungshäufigkeit%0a%0aUm des Empfängers Mailbox vor Überflutung zu schützen, benutzt das Benachrichtigungsskript einen "Rauschunterdrückungs-('''squelch''')"-Wert als minimale Zeitspanne, die zwischen zwei Benachrichtigungen an eine gegebene E-Mail-Adresse vergehen muss. Die ''Standardeinstellung für Squelch ist 10800 Sekunden (drei Stunden)'', d.&nbsp;h. dass, nachdem an eine Empfängeradresse eine Benachrichtigung versandt wurde, dieser für die nächsten drei Stunden keine weitere Benachrichtigung erhalten wird. Alle Änderungen, die während dieser Zeitspanne auflaufen, werden in eine Warteschlange für die nächste Benachrichtigung eingereiht.  %0a%0aDer Site-Administrator kann den Standardwert für ''squelch'' über den $NotifySquelch-Parameter ändern:%0a%0a->@@# Benachrichtigungen einschalten@@%0a->@@$EnableNotify = 1;@@%0a->@@$NotifySquelch = 86400;    # warte wenigstens eine Tag (in Sekunden) zwischen zwei Benachrichtigungen@@%0a%0aZusätzlich können individuelle Adressen einen angepassten Wert für den Squelch-Parameter in der SiteAdmin.NotifyList-Seite angeben:  %0a%0a->@@# Alice empfängt höchstens eine E-Mail pro Tag@@%0a->@@notify=alice@beispiel.de '''squelch'''=86400@@%0a%0a->@@# Bob kann stündliche Benachrichtigungen erhalten@@%0a->@@notify=bob@beispiel.de trail=Profiles.Bob '''squelch'''=3600@@%0a%0a->@@# Charles benutzt die Standardeinstellung der Site für die Zeitspanne@@%0a->@@notify=charles@beispiel.de@@%0a%0a[[#notifydelay]]%0a!! Kontrolle über Benachrichtigungsverzögerungen%0a%0aWeil eine Seite oft mehrere Änderungen in kurzer Zeit erfährt (nach einem langen Eintrag folgen mehrere kleine Korrekturen), kann ein Site-Administrator auch eine Verzögerung für Benachrichtigungen einrichten. Ein $NotifyDelay-Wert gibt an, wie lange nach einem anfänglichen Eintrag gewartet wird, bis eine Benachrichtigung versandt wird.%0a%0a->@@# Benachrichtigungen einschalten@@%0a->@@$EnableNotify = 1;@@%0a->@@$NotifySquelch = 86400;    # warte wenigstens eine Tag (in Sekunden) zwischen zwei Benachrichtigungen@@%0a->@@$NotifyDelay = 300;        # warte fünf Minuten nach dem ersten Eintrag@@%0a%0a{+Anmerkung+}\\%0aRauschunterdrückung und Verzögerung sind Minimumwerte; Benachrichtigungen werden versandt bei der nächsten Ausführung von PmWiki, nachdem die Verzögerungszeit abgelaufen ist.%0a%0aFür inaktive Sites kann das viel länger als die eingestellte Zeitspanne sein. Das ist aber nicht wirklich ein Problem, bei wenig aktiven Sites ist eine zeitige Benachrichtigung weniger wichtig. Jedenfalls werden Änderungen innerhalb der 'squelch'-Zeit nach der letzten Benachrichtigung unbemerkt bleiben, wenn das Wiki für eine lange Zeitspanne danach nicht wenigsten einmal besucht wird. Wenn das etwas ausmacht, mag es nötig sein, den Server zu veranlassen, ''pmwiki.php'' von Zeit zu Zeit über einen %0a[[http://de.wikipedia.org/wiki/Cron | cron job]] aufzurufen.%0a%0aAngepasste @@delay@@-Parameter können nicht für individuelle Adressen in der [[SiteAdmin.NotifyList]]-Seite angegeben werden. %0a%0a->@@# der delay=-Parameter wird ignoriert@@%0a->@@notify=edgar@beispiel.de trail=Profiles.Edgar '''delay'''=600@@%0a%0a%0a!! Bemerkung zu Windowsinstallationen%0a%0aBei Sites, wo PHP unter Windows läuft, könnte PHPs [[http://php.net/mail | Mail]]-Funktion nicht korrekt konfiguriert sein. Solche Sites müssten eventuell eine Zeile wie diese %0a%0a->@@ini_set('SMTP','smtp.server.com');@@%0a%0ain ''config.php'' einfügen, wobei  ''smtp.server.com'' der Name des von Ihrem Host bevorzugten Mail-Ausgangs-Servers ist. Sie könnten auch einen ''sendmail_from''-Wert setzen, wenn das nicht konfiguriert ist:%0a%0a->@@ini_set('sendmail_from','noreply@foo.com');@@%0a%0aund bei PHP im safe-mode: [[http://www.pmwiki.org/wiki/PITS/00976]].%0a%0a!![[#variables]] Benachrichtigungsvariablen%0a%0a:$EnableNotify: weist ''stdconfig.php'' an, das ''notify.php''-Skript anzuschalten%0a: :@@$EnableNotify = 1;          # Benachrichtigungen anschalten@@%0a: :@@$EnableNotify = 0;          # Benachrichtigungen ausschalten@@%0a%0a:$MailFunction: Die Funktion, die aufgerufen werden muss, wenn eine Nachricht versendet werden soll. Standardeinstellung ist die eingebaute PHP-Funktion [[http://php.net/mail|mail]]. Wenn Sie eine eigene E-Mail-Lösung oder -Bibliothek haben, setzen Sie hier die aufzurufende Funktion mit den gleichen Argumenten ein ($to, $subject, $message, $additional_headers).%0a%0a:$NotifyFrom: Antworten-An-Adresse, die in der E-Mail verwandt werden soll%0a: :@@$NotifyFrom = 'wiki@beispiel.de';@@%0a: :@@$NotifyFrom = 'Wiki-Server %3cwiki@beispiel.de>';@@%0a%0a%0a:$NotifyDelay: Die (Verzögerungs-) Zeitspanne (in Sekunden), die gewartet wird nach dem ersten Eintrag in eine Seite, bevor eine Benachrichtigung versandt wird. Der Standard ist null &mdash; Benachrichtigungen über Änderungen werden versandt, sobald die eingestellte Zeit für 'squelch' abgelaufen ist%0a: :@@$NotifyDelay = 300;    # sende Mail 5+ Minuten nach dem ersten Eintrag@@%0a%0a:$NotifySquelch: Die Standardzeitspanne, die zwischen dem Versand der E-Mails mit den Benachrichtigungen vergehen muss. Nützlich, wenn $NotifyDelay auf einen kleinen Wert gesetzt wird, um die Zahl der E-Mails mit Benachrichtigungen niedrig zu halten. Standard ist 10800 (drei Stunden). Individuelle Empfänger können diesen Wert überschreiben in der SiteAdmin.NotifyList-Seite.  %0a: :@@$NotifySquelch = 43200;  # warte 12+ Stunden nach einem Versand@@%0a%0a:$NotifyItemFmt: Der Text, der für jede Änderung an einer Seite versandt wird. Der String "$PostTime" wird ersetzt durch die Zeit für die Änderung (kontrolliert durch $NotifyTimeFmt (s. u.))%0a: :@@# Standard@@%0a: :@@$NotifyItemFmt = ' * $FullName . . . $PostTime by $Author';@@%0a%0a: :@@# füge die URL der Seite in die Nachricht ein@@%0a: :@@$NotifyItemFmt = " * \$FullName . . . \$PostTime von \$Author\n     \$PageUrl";@@%0a%0a: :@@# füge die Zusammenfassung und den Verweis auf den Änderungsverlauf (Versionen) in die Nachricht ein @@%0a: :@@$NotifyItemFmt = @@%0a: :@@" * {\$FullName} . . . \$PostTime von {\$Author} @@%0a: :@@\n Zusammenfassung: {\$LastModifiedSummary}\n {\$PageUrl}?action=diff";@@%0a%0a%0a:$NotifyTimeFmt: Das Format für Datum und Zeit in $PostTime (s. o.). Standard ist der Wert in $TimeFmt.%0a-->[@$NotifyTimeFmt = '%25Y-%25m-%25d, %25H:%25M Uhr';  # 2004-03-20, 17:44 Uhr@]%0a%0a:$NotifyBodyFmt: Der Rumpf der versandten Nachricht. \%0a   Der String "$NotifyItems" wird ersetzt durch die Liste der Änderungen (formatiert durch $NotifyItemFmt (s. o.)). \%0a   Benutze einfache Anführungszeichen ' , damit der Teilstring "$NotifyItems" nicht zu Unzeit \%0a   als Variable in ''config.php'' evaluiert wird. %0a: :@@$NotifyBodyFmt = "Changed items:\n\n" . '$NotifyItems' . "\n\n Best regards...";@@%0a%0a:$NotifySubjectFmt: Der Betreff der versandten Nachricht%0a%0a:$NotifyHeaders: String mit Extrazeilen im Mailheader, wird an die mail()-Funktion übergeben%0a%0a:$NotifyParameters: String mit zusätzlichen Parametern, die an die mail()-Funktion'^[[http://www.php.net/mail|#]]^' übergeben werden sollen.%0a%0a:$NotifyFile: Die Datei, mit deren Hilfe Notify die Informationen über kürzliche Änderungen im Auge behält. Standard ist @@[="$WorkDir/.notifylist"=]@@. Beachten Sie, dass der Webserver generell Schreibrechte für die Datei braucht. %0a%0a:$NotifyListPageFmt: Der Name der Seite, die die [@notify=@]-Zeilen enthält, welche ''notify.php'' benutzt. Standard ist [@$SiteAdminGroup.NotifyList@].%0a%0a:$NotifyList: Ein Array von [@notify=@]-Einträgen, das in die lokale Anpassungsdatei eingetragen werden kann (wird zusätzlich zu den Eintragungen in der SiteAdmin.NotifyList-Seite genutzt)%0a: :@@# Sende Benachrichtigungen an alice@beispiel.de@@%0a: :@@$NotifyList[] = 'notify=alice@beispiel.de';@@%0a%0a:$EnableNotifySubjectEncode: Wende eine Standard-(base64)-Kodierung für die E-Mail-Nachricht an. Andernfalls könnten E-Mails von internationalen Wikis unlesbare Nachrichten enthalten (hinzugefügt seit Version 2.2.2). %0a: :@@$EnableNotifySubjectEncode = 1;          # kodiere Nachricht@@%0a: :@@$EnableNotifySubjectEncode = 0;          # nimm die Nachricht wie sie ist (Standard)@@%0a: :Um Kodierungen im Nachrichtenrumpf zu bekommen, fügen Sie die folgende Zeile in die ''config.php'' ein (nach XLPage und/oder [[PmWiki/UTF-8]]):%0a: :@@$NotifyHeaders = "Content-type: text/plain; charset=$Charset";@@%0a%0a!! Benachrichtigung nur bei größeren Änderungen%0a%0aEs ist möglich, Benachrichtigungen nur bei größeren Änderungen zu versenden (Häkchen bei ''Dies ist eine geringfügige Änderung'' nicht gesetzt). Ersetzen Sie "$EnableNotify=1;" in der ''config.php'' durch die folgende Zeile%0a%0a->@@if ( @$_POST['diffclass'] != 'minor' ) $EnableNotify=1;@@%0a%0aAuf diese Weise werden nur für größere Änderungen Benachrichtigungen versandt (wenn der Autor das Häkchen für'' geringfügige Änderungen'' nicht setzt). Wenn Sie über geringfügige Änderungen, aber nicht über größere Änderungen benachrichtigt werden wollen, dann schreiben Sie%0a%0a->@@if ( @$_POST['diffclass'] == 'minor' ) $EnableNotify=1;@@%0a%0astattdessen.%0a%0a!! Abschalten der Benachrichtigung für Downloads%0a%0aWenn Sie "$EnableDirectDownloads=0;" benutzen (z. B. für Datenschutz/Vertraulichkeit in einem passwortgeschützten Wiki), erzeugen angehängte Bilder doppelte Benachrichtigungen. Um das zu verhindern, schalten Sie die Benachrichtigungen für Downloads ab:%0a %0a->@@if ( $action != 'download' ) $EnableNotify=1;@@%0a%0aAuf diese Weise werden nur 'page views' (und keine Bilder innerhalb der Seite) Benachrichtigungen auslösen. Siehe PITS:01159 wegen weiterer Informationen.%0a
time=1515585875
title=E-Mail Nachricht bei geänderten Seiten (neu)
